<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Chart.js - Risiko Deforestasi</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin:0; padding:0; width:100%; height:100%;
      font-family:'Roboto Mono', monospace;
      background:#fff; color:#222;
      overflow:hidden;
    }
    * { font-family: 'Roboto Mono', monospace !important; }
     .wrap {
      width:100%; height:100%; display:flex; flex-direction:column;
    }
    .controls {
      text-align:right; padding:8px;
    }
    select {
      padding:2px 6px; border-radius:4px; border:1px solid #ccc;
      font-family:'Roboto Mono', monospace; font-size:12px;
    }
    h1{font-size:14px;font-weight:normal;margin:0 0 6px;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;text-align:center}
    .chart-container {
      flex:1; position:relative; width:100%; height:100%;
    }
    canvas {
      width:100% !important; height:100% !important;
    }

    .chart-container{
      height:85% !important;
    }
     /* Versi mobile */
    @media (max-width: 600px) {
    
  </style>
</head>
<body>
<div class="wrap">
  <div class="controls">
    <h1 style="font-size:0.8em; line-height:1.4; text-align: left;">
      Risiko Deforestasi per Group
      <select id="modeSelect">
        <option value="plot" selected>Plot</option>
        <option value="percent">Persentase (%)</option>
      </select>
    </h1>
  </div>
  <div class="chart-container">
    <canvas id="deforestasiChart"></canvas>
  </div>
</div>

<script>
const fullLabels = ["Hutan Lestari", "Tunas Jaya", "Simpang Bayur", "Lestari Sejahtera"];
const shortLabels = ["HL", "TJ", "SB", "LS"];

function getLabels() {
  return window.innerWidth < 600 ? shortLabels : fullLabels;
}

// Data asli (plot)
const rawData = {
  Rendah: [61, 521, 86, 278],
  Tinggi: [1, 0, 0, 7],
  Info: [9, 79, 35, 165]
};

// Hitung persentase
function toPercent(dataObj) {
  const totals = rawData.Rendah.map((_, i) =>
    rawData.Rendah[i] + rawData.Tinggi[i] + rawData.Info[i]
  );
  return {
    Rendah: rawData.Rendah.map((v,i)=> (v/totals[i]*100).toFixed(1)),
    Tinggi: rawData.Tinggi.map((v,i)=> (v/totals[i]*100).toFixed(1)),
    Info: rawData.Info.map((v,i)=> (v/totals[i]*100).toFixed(1))
  };
}

const percentData = toPercent(rawData);

function buildData(mode="plot") {
  const labels = getLabels();
  if(mode==="percent"){
    return {
      labels: labels,
      datasets: [
        { label:"Rendah", data:percentData.Rendah, backgroundColor:"#007bff"  },
        { label:"Tinggi", data:percentData.Tinggi, backgroundColor:"#dc3545" },
        { label:"Butuh Informasi Lanjutan", data:percentData.Info, backgroundColor:"darkgray"  }
      ]
    };
  } else {
    return {
      labels: labels,
      datasets: [
        { label:"Rendah", data:rawData.Rendah, backgroundColor:"#007bff"  },
        { label:"Tinggi", data:rawData.Tinggi, backgroundColor:"#dc3545"  },
        { label:"Butuh Informasi Lanjutan", data:rawData.Info, backgroundColor:"darkgray" }
      ]
    };
  }
}

let mode="plot";
let chart = new Chart(document.getElementById("deforestasiChart"), {
  type:"bar",
  data: buildData(mode),
  options:{
    responsive:true,
    maintainAspectRatio:false,
    plugins:{
      legend:{ position:"bottom", labels:{ font:{family:"Roboto Mono"} } },
      tooltip:{ 
        bodyFont:{family:"Roboto Mono"}, 
        titleFont:{family:"Roboto Mono"},
        callbacks:{
          label: function(context){
            if(mode==="percent"){
              return context.dataset.label + ": " + context.formattedValue + "%";
            } else {
              return context.dataset.label + ": " + context.formattedValue + " plot";
            }
          }
        }
      },
      datalabels:{
        anchor:"end", align:"end", font:{family:"Roboto Mono",size:11},
        formatter:(value,ctx)=> mode==="percent" ? value+"%" : value
      }
    },
    scales:{
      y:{
        title:{ display:true, text:"Jumlah", font:{ family:"Roboto Mono" } },
        ticks:{ font:{ family:"Roboto Mono" } }
      },
      x:{
        title:{ display:true, text:"Group", font:{ family:"Roboto Mono" } },
        ticks:{ font:{ family:"Roboto Mono" } }
      }
    }
  },
  plugins:[ChartDataLabels]
});

document.getElementById("modeSelect").addEventListener("change", function(){
  mode=this.value;
  chart.data = buildData(mode);
  chart.options.scales.y.title.text = (mode==="percent") ? "Persentase (%)" : "Jumlah";
  chart.update();
});

window.addEventListener("resize",()=>{
  chart.data.labels = getLabels();
  chart.update();
});
</script>
</body>
</html>
